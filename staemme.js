var staemme;(()=>{"use strict";var e={595:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(601),a=n.n(i),r=n(314),s=n.n(r)()(a());s.push([e.id,".sta-login-header {\n    width: 100%;\n}\n\n.sta-login-parent {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.sta-login-item {\n    display: flex;\n    width: fit-content;\n}\n",""]);const o=s},407:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(601),a=n.n(i),r=n(314),s=n.n(r)()(a());s.push([e.id,"#menuButton {\n    cursor: pointer;\n}\n\n.sta-menu-item-checkbox-first-child {\n    margin: 3px 0px 0px;\n}\n\n.sta-menu-item-checkbox {\n    margin: 1px 0px 0px;\n}\n\n.sta-menu-item-container {\n    display: flex;\n    gap: 3px;\n    align-items: center;\n    left: -5px;\n    position: relative;\n}\n\n.sta-leftUiThingyFirstChild {\n    background: transparent url(https://dsde.innogamescdn.com/asset/c045337f/graphic/index/dropdown-topleft.png) scroll left top no-repeat;\n    height: 21px;\n    width: 20px;\n    left: -5px;\n    position: relative;\n}\n\n.sta-leftUiThingy {\n    background: transparent url(https://dsde.innogamescdn.com/asset/c045337f/graphic/index/dropdown-itemleft.png) scroll left top no-repeat;\n    height: 21px;\n    width: 20px;\n    left: -5px;\n    position: relative;\n}\n\n.sta-menu-column-item-text-first-child:hover, .sta-menu-column-item-text:hover, #iconContainer:hover {\n    color: #f0d49a;\n}\n\n.sta-menu-column-item-text-first-child {\n    padding: 5px 12px 3px 6px;\n    left: -5px;\n    position: relative;\n}\n\n.sta-menu-column-item-text {\n    padding: 4px 12px 3px 6px;\n    left: -5px;\n    position: relative;\n}\n\n.sta-menu-column-item {\n    display: flex !important;\n    flex-direction: row;\n}\n\n.sta-corner {\n    left: -5px !important;\n}\n\n.sta-menu-column {\n    margin-left: 4px !important;\n    border-spacing: 0;\n}\n\n.sta-construction-building-upgradeable {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.sta-construction-building-level-upgradeable {\n    background-color: #f0e2be;\n    font-weight: 700;\n    color: #603000;\n    cursor: pointer;\n    width: 22px;\n    height: 18px;\n    padding: 2px;\n    text-align: center;\n    align-content: center;\n}\n\n.sta-building-icon {\n    background-image: url(https://dsde.innogamescdn.com/asset/234518f7/graphic/screen/tableheader_bg3.png);\n    background-size: contain;\n    width: 18px;\n    height: 18px;\n    padding: 4px;\n}\n\n.sta-total-level {\n    display: flex;\n    gap: 2px;\n    width: fit-content;\n    flex-grow: 0;\n}\n\n.sta-construction-menu-buildplan {\n    display: flex;\n    flex-direction: row;\n    gap: 4px;\n}\n",""]);const o=s},718:(e,t,n)=>{n.d(t,{A:()=>g});var i=n(601),a=n.n(i),r=n(314),s=n.n(r),o=n(417),l=n.n(o),d=new URL(n(535),n.b),c=new URL(n(377),n.b),u=s()(a()),h=l()(d),p=l()(c);u.push([e.id,`.sta-container {\n    background: url(https://dsde.innogamescdn.com/asset/234518f7/graphic/index/grey-fade.png);\n    height: 100%;\n}\n\n.sta-popup {\n    transition-duration: 0.5s;\n    z-index: 15000;\n    border-radius: 16px;\n    overflow: auto;\n    padding: 10px;\n    background-color: rgb(227, 213, 179);\n    background-image: url(https://dsde.innogamescdn.com/asset/234518f7/graphic/index/main_bg.jpg);\n}\n\n.sta-nav-item {\n    color: #603000;\n    cursor: pointer;\n    width: -webkit-fill-available;\n    font-weight: 700;\n    padding: 2px 3px;\n    background-color: rgb(244, 228, 188);\n}\n\n.sta-nav-item.sta-nav-item-selected {\n    background-color: rgb(250, 220, 155);\n    color: #803000;\n}\n\n.sta-logs {\n    font-weight: 700;\n    color: #603000;\n    cursor: pointer;\n}\n\n.sta-popup-header-label {\n}\n\n.sta-popup-description {\n    flex-grow: 1;\n    flex-shrink: 1;\n    padding-left: 50px;\n    padding-right: 50px;\n    max-width: 500px;\n}\n\n.sta-logs:hover {\n    color: #e01f0f;\n}\n\n.sta-popup-header-container {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    gap: 4px;\n    align-content: center;\n    margin-bottom: 25px;\n}\n\n.sta-construction-building-level-upgradeable:hover, .sta-nav-item:hover {\n    color: #e01f0f;\n}\n\n.sta-popup-content {\n    gap: 10px;\n    display: flex;\n}\n\n.sta-menu-component {\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n    position: relative;\n}\n\n.sta-labelled-input {\n    display: flex;\n    background-color: rgb(244, 228, 188);\n    padding: 2px 3px;\n    gap: 2px;\n    flex-grow: 1;\n    max-width: 500px;\n}\n\n.sta-input-label {\n    align-content: center;\n}\n\n.sta-numeric-input {\n    width: 25pt;\n}\n\n.clickable {\n    cursor: pointer;\n}\n\n.sta-menu-header {\n    font-weight: 700;\n    background-image: url(https://dsde.innogamescdn.com/asset/234518f7/graphic/screen/tableheader_bg3.png);\n    padding: 2px 3px;\n}\n\n.sta-menu-item-row {\n    display: flex;\n    gap: 2px;\n}\n\n.sta-menu-setting-label {\n    background-color: rgb(244, 228, 188);\n    padding: 2px 3px;\n    align-content: center;\n    min-width: 135px;\n}\n\n.sta-nav {\n    display: flex;\n    flex-direction: column;\n    height: fit-content;\n    width: fit-content;\n    gap: 2px;\n}\n\n.sta-fade-in {\n    animation: fadein 0.5s linear;\n    position: relative;\n}\n\n.sta-fade-out {\n    animation: fadeout 0.3s linear;\n    position: relative;\n}\n\n.sta-info {\n    background: url('https://dsde.innogamescdn.com/asset/234518f7/graphic/questionmark.png') no-repeat center;\n    background-size: 17px;\n    width: 17px;\n    height: 17px;\n    margin-top: 3px;\n    flex-shrink: 0;\n}\n\n@-webkit-keyframes fadein {\n    0% {\n        opacity: 0;\n        z-index: -1;\n        top: 50px;\n    }\n    100% {\n        opacity: 1;\n        z-index: auto;\n        top: 0px;\n    }\n}\n\n@-webkit-keyframes fadeout {\n    0% {\n        opacity: 1;\n        margin-left: 0px;\n    }\n    100% {\n        opacity: 0;\n        margin-left: -70px;\n    }\n}\n\n.sta-feature-header-premiun-icon {\n    width: 15px;\n    height: 15px;\n    margin-top: 2px;\n}\n\n.sta-feature-header-premium {\n    background-image: url(https://dsde.innogamescdn.com/asset/234518f7/graphic/screen/tableheader_bg3.png);\n    padding: 0px 3px;\n    display: flex;\n    flex-direction: row;\n    gap: 2px;\n}\n\n.sta-construction-entries {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.sta-construction-plan {\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    gap: 2px;\n}\n\n.sta-construction-plan-inverted {\n    flex-direction: column-reverse !important;\n}\n\n.sta-construction-plan-inverter {\n    font-weight: 700;\n    color: #603000;\n    cursor: pointer;\n}\n\n.sta-construction-plan-inverter:hover {\n    color: #e01f0f;\n}\n\n.sta-construction-entry-preview {\n    margin-bottom: 2px;\n}\n\n.sta-construction-entry-row {\n    display: flex;\n    flex-direction: row;\n    gap: 2px;\n    align-content: center;\n    background-color: rgb(244, 228, 188);\n    align-items: center;\n}\n\n.sta-construction-entry-icon {\n    width: 18px;\n    height: 18px;\n    padding: 2px 4px;\n}\n\n.sta-construction-entry-name {\n    font-weight: 700;\n    color: #603000;\n}\n\n.sta-construction-entry-level {\n    flex-grow: 1;\n}\n\n.sta-construction-entry-plus {\n    background: url(${h}) center no-repeat;\n    background-size: contain;\n    width: 14px;\n    height: 14px;\n    margin: 4px;\n    cursor: pointer;\n}\n\n.sta-construction-entry-minus {\n    background: url(${p}) center no-repeat;\n    background-size: contain;\n    width: 14px;\n    height: 14px;\n    margin: 4px;\n    cursor: pointer;\n}\n\n.sta-construction-entry-remove {\n    background: url(https://dsde.innogamescdn.com/asset/234518f7/graphic/delete.png) center no-repeat;\n    width: 22px;\n    height: 22px;\n    cursor: pointer;\n}\n\n.sta-construction-entry-drag {\n    background: url(https://dsde.innogamescdn.com/asset/234518f7/graphic/sorthandle.png) center no-repeat;\n    width: 22px;\n    height: 22px;\n    cursor: pointer;\n}\n\n.sta-village-list-entry {\n    display: flex;\n    background-color: #f4e4bc;\n}\n\n.sta-village-list-name {\n    font-weight: 700;\n    text-decoration: none;\n    color: #603000;\n    flex-grow: 1;\n    padding-right: 4px;\n}\n\n.sta-village-list-coords {\n    font-weight: bold;\n    text-align: right;\n    padding-right: 4px;\n}\n\n.sta-building-selector {\n    display: flex;\n    gap: 2px;\n    flex-direction: column;\n}\n`,""]);const g=u},772:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(601),a=n.n(i),r=n(314),s=n.n(r)()(a());s.push([e.id,'.sta-report-process {\n    background: url("https://dsde.innogamescdn.com/asset/62e187d5/graphic/btn/buttons.png") no-repeat 3px -248px, linear-gradient(to bottom, #947a62 0%,#7b5c3d 22%,#6c4824 30%,#6c4824 100%);\n    padding-left: 25px;\n}\n\n.sta-report-process:hover {\n    background: url("https://dsde.innogamescdn.com/asset/62e187d5/graphic/btn/buttons.png") no-repeat 3px -248px, linear-gradient(to bottom, #b69471 0%,#9f764d 22%,#8f6133 30%,#6c4d2d 100%);\n    padding-left: 25px;\n}\n',""]);const o=s},620:(e,t,n)=>{n.d(t,{A:()=>o});var i=n(601),a=n.n(i),r=n(314),s=n.n(r)()(a());s.push([e.id,".totalResCounter {\n    display: flex;\n    gap: 4px;\n    justify-content: center;\n    align-items: center;\n}\n",""]);const o=s},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,a,r){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var o=0;o<this.length;o++){var l=this[o][0];null!=l&&(s[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);i&&s[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),a&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=a):c[4]="".concat(a)),t.push(c))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var r={},s=[],o=0;o<e.length;o++){var l=e[o],d=i.base?l[0]+i.base:l[0],c=r[d]||0,u="".concat(d," ").concat(c);r[d]=c+1;var h=n(u),p={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(p);else{var g=a(p,i);i.byIndex=o,t.splice(o,0,{identifier:u,updater:g,references:1})}s.push(u)}return s}function a(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,a){var r=i(e=e||[],a=a||{});return function(e){e=e||[];for(var s=0;s<r.length;s++){var o=n(r[s]);t[o].references--}for(var l=i(e,a),d=0;d<r.length;d++){var c=n(r[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}r=l}}},659:e=>{var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var a=void 0!==n.layer;a&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,a&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},535:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAilJREFUSEvtlT9oU1EUxn/nviQNNK1/QG3VQpGGahNbMUIpieIiCCI4ieDk5KRgFyeliuBScHNxcNBBKm4OpYODWIpgUayplRQsIm4qrdWa5L179FFLn4nmtU0n8Y7nnvN995x7zvmEsDOA6TyVbYkoZ0U5pqgBeWhcuTHR/eRzWLiEOXQUepvjnnNOrVwL+M4Dt/Jdo/1h8aEEeyYPthq1Qwi5CrC3+VejSU7i1SIJJeguHN7pld1HoMkKoJn4t+/7xg+Mz9ZF0POmb0fZM8MC6f8Efyxl/SUawHSc7k1Ey7HGaNRxxBY1yGSt02LRuyi7f3uB6nsT0SMGvgTtZdc4tuQZN6GfppNP56RzKrs9ip5RT44isk3RYjBAhIgq7QLxihRLwLSCXbKLYlTYCNooMIjqTUm9zl5BuRw2MGu4nxfhtqQns88UMmsAWEnIjJ/BC5SelXiv0kcVCpKazF4FLgCJVQLUcvcb5ePPxrgne1/mNtmIXgJOANWrQzWCyFYgVoHoAh8IfPLyvSxgdThWYnAZcAgnsytTlUWpKdZqPfMA6KogeCeek2sofp0L2mc3RHRL3JTH2sYWfHvosqt/0EIK/28QuK4ZQar+YH30ID1xqM067mNB2iv1oBh1e/x9U5fgLEqm3kc0GwBSkKnmJi+z1C1/IwntIl/0G8rOeZCLv4ZxcYgsd/LpdRB9/2WpfN9mMWZAleMKJVFGYkWuP98/6g9azfMD7D0FlN+wuocAAAAASUVORK5CYII="},377:e=>{e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAM1BMVEUAAAAAZ/8AZv8AZv8AZ/8AZv8AZv8AZv8AZv8AZv8AZv8AZv8AZv8AZf8AZv8AZv////+Fr8V6AAAAD3RSTlMAT+jmSuTh9/37/PrgR9w26QDFAAAAAWJLR0QQlbINLAAAAAd0SU1FB+YKFBM0M4OYBZ4AAAA8SURBVDjL7dKpAQAwCEPR9ITe+2/bDYJF8CxfRAAEN1J+RKloj+oQHigGDyaUB8sKBNsaeTq73xOP4McHs4IObtg7GTsAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjItMTAtMjBUMTk6NTI6NTErMDA6MDASOJbCAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIyLTEwLTIwVDE5OjUyOjUxKzAwOjAwY2UufgAAAABJRU5ErkJggg=="}},t={};function n(i){var a=t[i];if(void 0!==a)return a.exports;var r=t[i]={id:i,exports:{}};return e[i](r,r.exports,n),r.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.b=document.baseURI||self.location.href,n.nc=void 0;var i={};(()=>{n.r(i),n.d(i,{initStaemmeBot:()=>xe});var e=n(72),t=n.n(e),a=n(825),r=n.n(a),s=n(659),o=n.n(s),l=n(56),d=n.n(l),c=n(540),u=n.n(c),h=n(113),p=n.n(h),g=n(407),m={};m.styleTagTransform=p(),m.setAttributes=d(),m.insert=o().bind(null,"head"),m.domAPI=r(),m.insertStyleElement=u();t()(g.A,m);g.A&&g.A.locals&&g.A.locals;var v=n(718),f={};f.styleTagTransform=p(),f.setAttributes=d(),f.insert=o().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=u();t()(v.A,f);v.A&&v.A.locals&&v.A.locals;var E;!function(e){e.GAME_DURATION_EXPONENT="sta-game-duration-exponent",e.GAME_DURATION_FACTOR="sta-game-duration-factor",e.GAME_DURATION_INITIAL_SECONDS="sta-game-duration-initial-seconds",e.RUNNING="sta-running",e.AUTO_LOGIN_WORLD="sta-auto-login-world",e.LOGS="sta-logs",e.VILLAGE_DATA="sta-village-data",e.SCAVENGE_ENABLED="sta-scavenge-enabled",e.SCAVENGE_NEXT_RUN="sta-scavenge-next-run",e.SCAVENGE_KEEP_SPEAR="sta-scavenge-keep-spear",e.SCAVENGE_KEEP_SWORD="sta-scavenge-keep-sword",e.SCAVENGE_KEEP_AXE="sta-scavenge-keep-axe",e.SCAVENGE_KEEP_LIGHT="sta-scavenge-keep-light",e.SCAVENGE_KEEP_HEAVY="sta-scavenge-keep-heavy",e.SCAVENGE_COLLECTED_RESOURCES="sta-scavenge-collected-resources",e.CONSTRUCTION_ENABLED="sta-construction-enabled",e.CONSTRUCTION_BUILD_CODE="sta-construction-build-code",e.CONSTRUCTION_NEXT_RUN="sta-construction-next-run",e.CONSTRUCTION_PLAN_INVERTED="sta-construction-plan-inverted",e.REWARD_ENABLED="sta-reward-enabled",e.REWARD_NEXT_RUN="sta-reward-next-run",e.REPORT_ENABLED="sta-report-enabled",e.REPORT_ARCHIVE="sta-report-archive",e.REPORT_DB_USER="sta-report-db-user",e.REPORT_DB_PASSWORD="sta-report-db-password"}(E||(E={}));var b,x=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};function N(e){localStorage.removeItem(e)}function y(e,t){localStorage.setItem(e,t)}function A(e,t){localStorage.setItem(e,t)}function C(e){return localStorage.getItem(e)}function w(e){return localStorage.getItem(e)}function _(e){UI.SuccessMessage(e,4e3)}function L(e){UI.ErrorMessage(e,4e3)}function S(e,t){e.setAttribute("data-title",t),UI.ToolTip(e)}function R(e){return new Promise((t=>setTimeout(t,e)))}function B(){return game_data}let D=null!==(b=JSON.parse(C(E.LOGS)))&&void 0!==b?b:[];function T(...e){for(let t of e)D.push((new Date).toLocaleString("de-DE")+" - "+t);for(let e=0;e<D.length-1e3;e++)D.shift();y(E.LOGS,JSON.stringify(D))}function k(){let e=U(+w("sta-scavenge-next-run")/1e3),t=U(+w("sta-construction-next-run")/1e3),n=U(+w("sta-reward-next-run")/1e3),i=[...D];return i.push(`Reward next run in ${n}`),i.push(`Construction next run in ${t}`),i.push(`Scavenge next run in ${e}`),i}function O(e){return x(this,void 0,void 0,(function*(){return yield G(),$.get(e,(function(e){return e}))}))}function I(e,t){return x(this,arguments,void 0,(function*(e,t,n="GET",i={"Tribalwars-Ajax":1}){return yield G(),$.ajax(e,{headers:i,method:n,data:t})}))}function P(e,t){return x(this,void 0,void 0,(function*(){return yield G(),$.post(e,t,(function(e){return e}))}))}function U(e){let t=Math.floor(e-Date.now()/1e3),n=Math.floor(t/60),i=Math.floor(n/60);return t-=60*n,n-=60*i,1==i.toString().length&&(i="0"+i),1==n.toString().length&&(n="0"+n),1==t.toString().length&&(t="0"+t),i+":"+n+":"+t}let M=0;function G(){return x(this,void 0,void 0,(function*(){if(M>500){T("Reached request threshold. Logout");let e=B();window.location.href=window.location.origin+`/game.php?village=${e.village.id}&screen=&action=logout&h=${e.csrf}`}else M++,yield R(200)}))}var V=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class q{constructor(e){try{this.container=this.create(),this.popup=this.container.children[0],this.popup.appendChild(this.createHeader()),this.popup.appendChild(this.createContent(e))}catch(e){console.error(e)}}show(e){return V(this,void 0,void 0,(function*(){this.container.style.display="",this.popup.style.minWidth="400px",this.popup.style.maxWidth="70vw",this.popup.style.maxHeight="80vh",this.popup.style.minHeight="260px";let t=this.popup.getElementsByClassName("sta-nav")[0].children;for(let n=0;n<t.length;n++)t[n].textContent===e&&t[n].click()}))}create(){let e=document.createElement("div");e.className="popup_box_container sub-dialog sta-container",document.getElementById("ds_body").appendChild(e),e.addEventListener("click",(()=>{this.popup.style.minWidth="0px",this.popup.style.maxWidth="0vw",this.popup.style.maxHeight="0vh",this.popup.style.minHeight="0px",setTimeout((()=>{e.style.display="none"}),500)})),e.style.display="none";let t=document.createElement("div");return t.className="popup_box slim mobile show sta-popup",e.appendChild(t),t.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation()})),e}createHeader(){let e=document.createElement("div");e.className="sta-popup-header-container";let t=document.createElement("div");t.className="sta-info",e.appendChild(t),S(t,"Der Bot automatisiert Aufgaben im Hintergrund, ist aber nur für die Anfangsphase empfohlen. Sobald der Account Manager freigeschalten ist bitte unbedingt wechseln!");let n=document.createElement("h2");n.className="sta-popup-header-label",n.textContent="Bot",e.appendChild(n);let i=document.createElement("div");i.className="sta-popup-description",i.textContent="Der Bot läuft nur wenn das kleines Stammessymbol neben 'Bot' in der Menüleiste blau leuchtet, \n        klicke darauf um es umzuschalten. Dann führt er alle Aufgaben aus die hier oder über das Menü aktiviert sind.",e.appendChild(i);let a=document.createElement("div");return a.className="sta-logs",a.textContent="Kopiere logs",S(a,"Kopiert die letzten Log-Einträge in die Zwischenablage, vermutlich nur für den Entwickler interessant falls es Probleme gibt. Discord: Jimmy653"),a.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();let t="";for(let e of k())t+=e+"\n";navigator.clipboard.writeText(t).then((()=>{T("Logs exported")})).catch((()=>{T("Error during export of logs")}))})),e.appendChild(a),e}createContent(e){let t=document.createElement("div");return t.className="sta-popup-content",t.appendChild(this.createNavItem(e,t)),t}createNavItem(e,t){let n=document.createElement("div");n.className="sta-nav";for(let i of e){let e=document.createElement("div");e.textContent=i.getName(),e.className="sta-nav-item",e.addEventListener("click",(a=>{if(a.preventDefault(),a.stopPropagation(),!e.className.includes("sta-nav-item-selected")){for(let e=0;e<n.children.length;e++)n.children[e].className="sta-nav-item";if(e.className+=" sta-nav-item-selected",t.children.length>1){let e=t.lastChild;e.className="sta-menu-component",e.remove()}t.appendChild(i.getComponent()),i.getComponent().className="sta-menu-component sta-fade-in"}})),n.appendChild(e)}return n}}var W=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class z{constructor(e,t){this.subscriptions=[];try{this.name=e,this.settings=t,this.component=document.createElement("div"),this.component.appendChild(this.createHeader(this.name));for(let e of this.settings)this.component.appendChild(this.createSetting(e))}catch(e){console.error(e)}}isPremium(){return this.premium}setError(e){this.error=e}isError(){return this.error}getEnabledSetting(){return this.settings[0].setting}getName(){return this.name}getComponent(){return this.component}subscribe(e,t){this.subscriptions.push({callback:e,setting:t})}invertEnabled(e){return W(this,void 0,void 0,(function*(){yield R(100);let t=!("true"===C(e));y(e,t+"");for(let n of this.subscriptions)n.setting===e&&n.callback(t)}))}createHeader(e){let t=document.createElement("div");return t.className="sta-menu-header",t.textContent=e,t}setEnabledForVillage(e,t){A(`sta-${this.getName()}-${e}-enabled`.toLowerCase(),t+"")}isVillageEnabled(e){return"true"===w(`sta-${this.getName()}-${e}-enabled`.toLowerCase())}createBuildingSelector(){let e;try{e=JSON.parse(C(E.VILLAGE_DATA))}catch(e){throw T("Could not read village data"),"Could not read village data"}let t=document.createElement("div");t.className="sta-building-selector";let n=document.createElement("div");n.textContent="Dorf",n.className="sta-menu-header",t.appendChild(n);let i=[];for(let t of Object.keys(e))i.push({name:e[+t].name,id:+t});for(let n of i.sort(((e,t)=>e.name.toLowerCase().localeCompare(t.name.toLowerCase())))){let i=n.id,a=document.createElement("div");a.className="sta-village-list-entry",a.setAttribute("data-id",i+"");let r=document.createElement("input");r.type="checkbox",r.checked=this.isVillageEnabled(+i),r.className="clickable";let s=this,o=e=>W(this,void 0,void 0,(function*(){e.preventDefault(),e.stopPropagation(),yield R(10),r.checked=!this.isVillageEnabled(+i),s.setEnabledForVillage(i,r.checked)}));r.addEventListener("click",o);let l=document.createElement("div");l.textContent=e[i].name,l.className="sta-village-list-name clickable",l.addEventListener("click",o);let d=document.createElement("div");d.textContent=e[i].coord,d.className="sta-village-list-coords",a.append(r,l,d),t.appendChild(a)}return t}createPremium(e){this.premium=!0;let t=document.createElement("img");t.src="https://dsde.innogamescdn.com/asset/234518f7/graphic/premium/features/Premium_large.png",t.className="sta-feature-header-premiun-icon",S(t,e);let n=document.createElement("div");n.className="sta-feature-header-premium",n.appendChild(t),B().features.Premium.active||(t.style.opacity="0.5");let i=this.component.children[0];i.remove(),n.appendChild(i),this.component.insertBefore(n,this.component.children[0])}createSetting(e){let t=document.createElement("div");return t.className="sta-menu-item-row",t.appendChild(this.createShortLabel(e.short)),t.appendChild(this.createLabelledInput(e)),t}createShortLabel(e){let t=document.createElement("div");return t.className="sta-menu-setting-label",t.textContent=e,t}createLabelledInput(e){let t=document.createElement("div");t.className="sta-labelled-input";let n=document.createElement("div");n.textContent=e.long,n.className="sta-input-label","checkbox"===e.type&&(n.className+=" clickable",t.addEventListener("click",(t=>this.invertEnabled(e))));let i=this.createInput(e);return t.appendChild(i),t.appendChild(n),t}createInput(e){let t=document.createElement("input");switch(t.className="sta-setting-input-"+e.setting,e.type){case"checkbox":t.type="checkbox",t.checked="true"===C(e.setting),t.className+=" clickable",t.addEventListener("click",(t=>(t.preventDefault(),t.stopPropagation(),this.invertEnabled(e.setting)))),this.subscribe((e=>{t.checked=e}),e);break;case"numeric":t.type="text",t.inputMode="numeric",t.value=C(e.setting)||w(e.settingString),t.className+=" sta-numeric-input",t.addEventListener("change",(n=>{n.preventDefault(),n.stopPropagation(),e.setting?y(e.setting,t.value):A(e.settingString,t.value)}));break;case"text":t.type="text",t.value=C(e.setting)||w(e.settingString),t.addEventListener("change",(n=>{n.preventDefault(),n.stopPropagation(),e.setting?y(e.setting,t.value):A(e.settingString,t.value)}));break;case"password":t.type="password",t.value=C(e.setting)||w(e.settingString),t.className+=" sta-password-input",t.addEventListener("change",(n=>{n.preventDefault(),n.stopPropagation(),e.setting?y(e.setting,t.value):A(e.settingString,t.value)}))}return t}}class K{}var j=n(620),F={};F.styleTagTransform=p(),F.setAttributes=d(),F.insert=o().bind(null,"head"),F.domAPI=r(),F.insertStyleElement=u();t()(j.A,F);j.A&&j.A.locals&&j.A.locals;var J=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class H extends z{constructor(){super("Raubzug",[{short:"Aktiviert:",long:"Sendet die Truppen in ausgewählten Dörfern auf Raubzug, wenn der Bot läuft",setting:E.SCAVENGE_ENABLED,type:"checkbox"},{short:"Speere behalten:",long:"Anzahl der Speere die in jedem Dorf zuhause bleiben",setting:E.SCAVENGE_KEEP_SPEAR,type:"numeric"},{short:"Schwerter behalten:",long:"Anzahl der Schwerter die in jedem Dorf zuhause bleiben",setting:E.SCAVENGE_KEEP_SWORD,type:"numeric"},{short:"Äxte behalten:",long:"Anzahl der Äxte die in jedem Dorf zuhause bleiben",setting:E.SCAVENGE_KEEP_AXE,type:"numeric"},{short:"Leichte behalten:",long:"Anzahl der leichten Kavallarie die in jedem Dorf zuhause bleiben",setting:E.SCAVENGE_KEEP_LIGHT,type:"numeric"},{short:"Schwere behalten:",long:"Anzahl der schweren Kavallarie die in jedem Dorf zuhause bleiben",setting:E.SCAVENGE_KEEP_HEAVY,type:"numeric"}]);try{B().features.Premium.active?this.createPremium("Premium aktiv! Raubzüge werden unauffällig im Hintergrund gesendet!"):this.createPremium("Ohne Premium funktioniert dieses Feature aktuell nicht");let e=this.createBuildingSelector();this.component.appendChild(e);for(let t of e.children){let e=+t.getAttribute("data-id");if(!e)continue;let n=this.createInput({settingString:`sta-scavenge-${e}-hours-away`,type:"numeric"});t.insertBefore(n,t.children.item(0)),S(n,"Stunden wie lange deine Einheiten in diesem Dorf unterwegs sein sollen. (Ungefähr)")}}catch(e){console.error(e)}}onLoad(e,t){return J(this,void 0,void 0,(function*(){let n=new URLSearchParams(t.search);if(n.has("screen")&&"place"===n.get("screen")&&n.has("mode")&&"scavenge_mass"===n.get("mode"))try{return this.createResCounter(e).then((()=>this.updateResCounter(JSON.parse(C(E.SCAVENGE_COLLECTED_RESOURCES)))))}catch(e){T("Error injecting res count")}}))}preRun(){return J(this,void 0,void 0,(function*(){let e=+C(E.SCAVENGE_NEXT_RUN);return!(Date.now()<e)}))}run(){return J(this,void 0,void 0,(function*(){if(B().features.Premium.active&&this.isPremium())return this.runPremium();L("Raubzug kann aktuell nicht ohne Premium ausgeführt werden. Spenden via Paypal könnten die Entwicklung beschleunigen ;)")}))}postRun(){}runFree(){return J(this,void 0,void 0,(function*(){}))}runPremium(){return J(this,void 0,void 0,(function*(){let e="game.php?&screen=place&mode=scavenge_mass",t=[],n=this;$.getAll=function(e,t,n,i){var a=0,r=0;!function s(){if(a==e.length)return void n();let o=Date.now(),l=o-r;if(l<200){return void setTimeout(s,200-l)}r=o,$.get(e[a]).done((e=>{try{t(a,e),++a,s()}catch(e){i(e)}})).fail((e=>{i(e)}))}()};let i,a=[];return $.get(e,(function(t){i=$(t).find(".paged-nav-item").length>0?parseInt($(t).find(".paged-nav-item")[$(t).find(".paged-nav-item").length-1].href.match(/page=(\d+)/)[1]):0;for(let n=0;n<=i;n++){a.push(e+"&page="+n);let i=JSON.parse($(t).find('script:contains("ScavengeMassScreen")').html().match(/\{.*\:\{.*\:.*\}\}/g)[0]);y(E.GAME_DURATION_EXPONENT,i[1].duration_exponent),y(E.GAME_DURATION_FACTOR,i[1].duration_factor),y(E.GAME_DURATION_INITIAL_SECONDS,i[1].duration_initial_seconds)}})).done((function(){let e="[";return $.getAll(a,((t,n)=>{let i=$(n).find('script:contains("ScavengeMassScreen")').html().match(/\{.*\:\{.*\:.*\}\}/g)[2];i&&(e+=i+",")}),(()=>{e=e.substring(0,e.length-1),e+="]";try{t=JSON.parse(e)}catch(e){return console.error(e),T("Can't work with the data"),void L("Raubzug konnte nicht geladen werden. Enthält die aktuell ausgewählte Gruppe denn Dörfer?")}let i=n.countRes(t);return n.updateResCounter(i),n.sendMassScavenge(t)}),(e=>{T("Error running scavenge")}))}))}))}countRes(e){let t=JSON.parse(C(E.SCAVENGE_COLLECTED_RESOURCES));if(t||(t={unitIds:[],villages:{},day:(new Date).getDay(),total:0}),t.day!=(new Date).getDay()){for(let e of Object.keys(t.villages))t.villages[e].yesterdayTotal=t.villages[e].total,t.villages[e].total=0;t.yesterdayUnitIds=t.unitIds,t.yesterdayTotal=t.total,t.unitIds=[],t.total=0,t.day=(new Date).getDay()}for(let n=0;n<e.length;n++){let i=e[n],a=0,r=0,s=0;for(let e of Object.keys(i.options)){let n=i.options[e];n.is_locked||null==n.scavenging_squad||t.unitIds&&t.unitIds.includes(n.scavenging_squad.unit_id)||t.yesterdayUnitIds&&t.yesterdayUnitIds.includes(n.scavenging_squad.unit_id)||(t.unitIds.push(n.scavenging_squad.unit_id),a+=n.scavenging_squad.loot_res.wood,r+=n.scavenging_squad.loot_res.stone,s+=n.scavenging_squad.loot_res.iron)}t.villages[i.village_id]||(t.villages[i.village_id]={total:0}),t.villages[i.village_id].total+=a+r+s,t.total+=a+r+s}return y(E.SCAVENGE_COLLECTED_RESOURCES,JSON.stringify(t)),t}updateResCounter(e){return J(this,void 0,void 0,(function*(){let t=new URLSearchParams(window.location.search);if(!t.has("screen")||"place"!==t.get("screen")||!t.has("mode")||"scavenge_mass"!==t.get("mode"))return;let n=yield this.exists("mass-scavenge-table",document);for(let t of n.getElementsByTagName("tbody")[0].children){if(!t.attributes["data-id"]||!t.attributes["data-id"].value)continue;let n=+t.attributes["data-id"].value;t.getElementsByClassName("totalResCounter")[0].children[0].textContent=this.addDots(e.villages[n].total),t.getElementsByClassName("totalResCounter")[0].children[2].textContent=this.addDots(e.villages[n].yesterdayTotal)}}))}exists(e,t){return J(this,void 0,void 0,(function*(){for(let n=0;n<1e3;n++){if(t.getElementsByClassName(e)[0])return t.getElementsByClassName(e)[0];yield R(50)}throw"Could not find mass-scavenge-table by class name"}))}addDots(e){let t=(e+="").split("."),n=t[0],i=t.length>1?"."+t[1]:"";for(var a=/(\d+)(\d{3})/;a.test(n);)n=n.replace(a,"$1.$2");return n+i}createResCounter(e){return J(this,void 0,void 0,(function*(){let t=yield this.exists("mass-scavenge-table",e);for(let n of t.getElementsByTagName("tbody")[0].children){if(!n.attributes["data-id"]||!n.attributes["data-id"].value)continue;let t=n.attributes["data-id"].value,i=n.children[0];i.style.display="flex";let a=e.createElement("div");a.style.flexGrow="1",i.appendChild(a);let r=e.createElement("div");r.className="totalResCounter";let s=e.createElement("span");s.className="icon header ressources";let o=e.createElement("div");o.id=t+"todayTotal";let l=e.createElement("div");l.id=t+"yesterdayTotal",r.appendChild(o),r.appendChild(s),r.appendChild(l),S(o,"Heute"),S(l,"Gestern"),r.style.width="134px",i.appendChild(r)}}))}sendMassScavenge(e){return J(this,void 0,void 0,(function*(){let t="",n=0,i=[];for(let a=0;a<e.length;a++){let r=e[a];if(!this.isVillageEnabled(+r.village_id)){T(`${r.village_name} disabled for ${this.getName()}`);continue}let s=r.unit_counts_home.spear,o=r.unit_counts_home.sword,l=r.unit_counts_home.axe,d=r.unit_counts_home.light,c=r.unit_counts_home.heavy,u=[],h=[];$.each(r.options,(function(e){let t=r.options[e];t.is_locked||(u.push(t.base_id),null==t.scavenging_squad?h.push(t.base_id):(s+=t.scavenging_squad.unit_counts.spear,o+=t.scavenging_squad.unit_counts.sword,l+=t.scavenging_squad.unit_counts.axe,d+=t.scavenging_squad.unit_counts.light,c+=t.scavenging_squad.unit_counts.heavy,i.push(t.scavenging_squad.return_time)))}));let p=C(E.SCAVENGE_KEEP_SPEAR),g=C(E.SCAVENGE_KEEP_SWORD),m=C(E.SCAVENGE_KEEP_AXE),v=C(E.SCAVENGE_KEEP_LIGHT),f=C(E.SCAVENGE_KEEP_HEAVY);s-=Number.isNaN(p)?0:p,o-=Number.isNaN(g)?0:g,l-=Number.isNaN(m)?0:m,d-=Number.isNaN(v)?0:v,c-=Number.isNaN(f)?0:f;let b,x=r.unit_counts_home.spear,N=r.unit_counts_home.sword,y=r.unit_counts_home.axe,A=r.unit_counts_home.light,_=r.unit_counts_home.heavy,L=+w(`sta-scavenge-${r.village_id}-hours-away`);L&&(b=Math.pow(Math.floor(Math.pow(3600*L/+C(E.GAME_DURATION_FACTOR)-+C(E.GAME_DURATION_INITIAL_SECONDS),1/+C(E.GAME_DURATION_EXPONENT))/100),.5));let S=[0];S[1]=Math.floor(b/.1),S[2]=Math.floor(b/.25),S[3]=Math.floor(b/.5),S[4]=Math.floor(b/.75);let R=!0;(!L||!b||S[1]+S[2]+S[3]+S[4]>25*s+15*o+10*l+80*d+50*c)&&(R=!1);for(let e=1;e<=4;e++){let i=r.options[e];if(!h.includes(i.base_id))continue;let a=S[e],E=0,b=this.getWishedUnitCount(e,d,A,u.length,Number.isNaN(v)?0:v,E,80,a,R);E+=80*b;let C=this.getWishedUnitCount(e,s,x,u.length,Number.isNaN(p)?0:p,E,25,a,R);E+=25*C;let w=this.getWishedUnitCount(e,c,_,u.length,Number.isNaN(f)?0:f,E,50,a,R);E+=50*w;let B=this.getWishedUnitCount(e,o,N,u.length,Number.isNaN(g)?0:g,E,15,a,R);E+=15*B;let D=this.getWishedUnitCount(e,l,y,u.length,Number.isNaN(m)?0:m,E,10,a,R);E+=10*D;let k=C+B+D+4*b+6*w;k<10||(x-=C,N-=B,y-=D,A-=b,_-=w,T(R?`Adding ${r.village_name} option ${i.base_id} to request with ${k} units trying to run only ${L} hours using ${a} and reached ${E}`:`Adding ${r.village_name} option ${i.base_id} to request with ${k} units`),t&&(t+="&"),t+="squad_requests%5B"+n+"%5D%5Bvillage_id%5D="+r.village_id+"&squad_requests%5B"+n+"%5D%5Bcandidate_squad%5D%5Bunit_counts%5D%5Bspear%5D="+C+"&squad_requests%5B"+n+"%5D%5Bcandidate_squad%5D%5Bunit_counts%5D%5Bsword%5D="+B+"&squad_requests%5B"+n+"%5D%5Bcandidate_squad%5D%5Bunit_counts%5D%5Baxe%5D="+D+"&squad_requests%5B"+n+"%5D%5Bcandidate_squad%5D%5Bunit_counts%5D%5Blight%5D="+b+"&squad_requests%5B"+n+"%5D%5Bcandidate_squad%5D%5Bunit_counts%5D%5Bheavy%5D="+w+"&squad_requests%5B"+n+"%5D%5Bcandidate_squad%5D%5Bcarry_max%5D=9999999999&squad_requests%5B"+n+"%5D%5Boption_id%5D="+i.base_id+"&squad_requests%5B"+n+"%5D%5Buse_premium%5D=false",n++)}}if(n>0&&t){let e=new URLSearchParams(document.getElementById("menu_row2_village").children[0].href.split("?")[1]).get("village");return T("Sending "+n+" scavenges"),fetch(window.location.origin+"/game.php?village="+e+"&screen=scavenge_api&ajaxaction=send_squads",{headers:{accept:"application/json, text/javascript, */*; q=0.01","accept-language":"en-DE,en;q=0.9,de-DE;q=0.8,de;q=0.7,en-GB;q=0.6,en-US;q=0.5","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded; charset=UTF-8",pragma:"no-cache","sec-ch-ua":'"Google Chrome";v="123", "Not:A-Brand";v="8", "Chromium";v="123"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","tribalwars-ajax":"1","x-requested-with":"XMLHttpRequest"},referrer:"https://de224.die-staemme.de/game.php?village="+e+"&screen=place&mode=scavenge_mass",referrerPolicy:"strict-origin-when-cross-origin",body:t+"&h="+B().csrf,method:"POST",mode:"cors",credentials:"include"}).then((e=>{_(1===n?`${n} Raubzug wurde gestartet`:`${n} Raubzüge wurden gestartet`)})).catch((e=>{throw L("Fehler beim senden der Raubzüge"),e}))}{let e;if(0===i.length)e=(new Date).getTime()/1e3+3600;else{i.sort(((e,t)=>e-t));let t=Math.floor(Math.random()*(i.length/8));e=i[t]}y(E.SCAVENGE_NEXT_RUN,1e3*e+""),T(`${this.getName()} nothing to send...`)}}))}getWishedUnitCount(e,t,n,i,a,r,s,o,l){if(l){let e=0;for(;e+ +a<n&&r<=o;)e++,r+=s;return e}{let r=Math.floor(t/i);return r+=1==e?t%i:0,r+ +a>n&&(r=n-+a),r<0&&(r=0),r}}}let X=["main","barracks","stable","garage","church","church_f","watchtower","snob","smith","place","statue","market","wood","stone","iron","farm","storage","hide","wall"],Z=["Hauptgebäude","Kaserne","Stall","Werkstatt","Kirche","Kirche","Wachturm","Adelshof","Schmiede","Versammlungsplatz","Statue","Marktplatz","Holzfällerlager","Lehmgrube","Eisenmine","Bauernhof","Speicher","Versteck","Wall"];class Y{constructor(e){"string"==typeof e?(this.id=X.indexOf(e),this.name=e):(this.id=e,this.name=X[e]),this.uiName=Z[this.id]}getId(){return this.id}getName(){return this.name}getUiName(){return this.uiName}createIcon(e){let t=document.createElement("img");return t.src="https://dsde.innogamescdn.com/asset/234518f7/graphic/buildings/"+this.name+".png",t.className="tooltip-delayed sta-building-icon",e&&S(t,this.uiName),t}}var Q=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class ee extends Y{constructor(e,t,n,i){super(e),this.level=t,this.totalLevel=n.getLevel(),this.buildingTotal=n,this.previous=i}setNext(e){this.next=e}getNext(){return this.next}setPrevious(e){this.previous=e}getPrevious(){return this.previous}getTotalLevel(){return this.totalLevel}getLevel(){return this.level}addLevel(){this.level++}addTotalLevel(e){e===this.id&&(this.totalLevel++,this.buildingTotal.setLevel(this.totalLevel)),this.next&&this.next.addTotalLevel(e),this.updateUI()}removeLevel(){this.level--}removeTotalLevel(e){e===this.id&&(this.totalLevel--,this.buildingTotal.setLevel(this.totalLevel)),this.next&&this.next.removeTotalLevel(e),this.updateUI()}getComp(){return this.comp}getPreviewComp(e){let t=document.createElement("div");t.className="sta-construction-entry-row sta-fade-in sta-construction-entry-preview",document.createElement("div").textContent=e+". ";let n=this.createIcon(!1);n.className="sta-construction-entry-icon",t.appendChild(n);let i=document.createElement("div");i.className="sta-construction-entry-name",i.textContent=this.uiName,t.appendChild(i);let a=document.createElement("div");a.className="sta-construction-entry-level",a.textContent="+"+this.level+" (Stufe "+this.totalLevel+")",t.appendChild(a),this.updateUI();let r=document.createElement("div");r.className="sta-construction-entry-plus",S(r,"Stufe erhöhen"),t.appendChild(r);let s=e=>{e.preventDefault(),this.addLevel(),this.addTotalLevel(this.id),this.updatePreviewUI(a)};r.addEventListener("click",s);let o=document.createElement("div");o.className="sta-construction-entry-minus",S(o,"Stufe reduzieren"),t.appendChild(o);let l=e=>{e.preventDefault(),this.level<=1||(this.removeLevel(),this.removeTotalLevel(this.id),this.updatePreviewUI(a))};o.addEventListener("click",l);let d=document.createElement("div");d.className="sta-construction-entry-remove",S(d,"Eintrag löschen"),t.appendChild(d);let c=e=>{e.preventDefault(),d.removeEventListener("click",c),o.removeEventListener("click",l),r.removeEventListener("click",s);for(let e=0;e<this.level;e++)this.removeTotalLevel(this.id);this.fadeOut(this.comp),this.next&&this.next.setPrevious(this.previous),this.previous&&this.previous.setNext(this.next),this.updatePreviewUI(a)};return d.addEventListener("click",c),t}updateUI(){this.comp.getElementsByClassName("sta-construction-entry-level")[0].textContent="+"+this.level+" (Stufe "+this.totalLevel+")"}updatePreviewUI(e){e.textContent="+"+this.level+" (Stufe "+this.totalLevel+")"}paint(e){e&&e.level&&e.maxLevel&&e.found?e.level>=this.totalLevel?this.comp.style.backgroundColor="rgba(136,245,100,0.53)":e.maxLevel<this.totalLevel?this.comp.style.backgroundColor="rgba(245,100,100,0.53)":this.comp.style.backgroundColor="":this.comp.style.backgroundColor="rgba(161,161,161,0.53)"}create(){let e=document.createElement("div");e.className="sta-construction-entry-row sta-fade-in",this.comp=e;let t=this.createIcon(!1);t.className="sta-construction-entry-icon",e.appendChild(t);let n=document.createElement("div");n.className="sta-construction-entry-name",n.textContent=this.uiName,e.appendChild(n);let i=document.createElement("div");i.className="sta-construction-entry-level",e.appendChild(i),this.updateUI();let a=document.createElement("div");a.className="sta-construction-entry-plus",S(a,"Stufe erhöhen"),e.appendChild(a);let r=e=>{e.preventDefault(),this.addLevel(),this.addTotalLevel(this.id)};a.addEventListener("click",r);let s=document.createElement("div");s.className="sta-construction-entry-minus",S(s,"Stufe reduzieren"),e.appendChild(s);let o=e=>{e.preventDefault(),this.level<=1||(this.removeLevel(),this.removeTotalLevel(this.id))};s.addEventListener("click",o);let l=document.createElement("div");l.className="sta-construction-entry-drag",S(l,"Feature noch nicht implementiert. Spenden via Paypal könnten die Entwicklung beschleunigen ;)"),e.appendChild(l);let d=e=>{e.preventDefault()};l.addEventListener("drag",d);let c=document.createElement("div");c.className="sta-construction-entry-remove",S(c,"Eintrag löschen"),e.appendChild(c);let u=e=>{e.preventDefault(),c.removeEventListener("click",u),s.removeEventListener("click",o),a.removeEventListener("click",r),l.removeEventListener("click",d);for(let e=0;e<this.level;e++)this.removeTotalLevel(this.id);this.fadeOut(this.comp),this.next&&this.next.setPrevious(this.previous),this.previous&&this.previous.setNext(this.next)};return c.addEventListener("click",u),e}fadeOut(e){return Q(this,void 0,void 0,(function*(){e.classList.remove("sta-fade-in"),e.className+=" sta-fade-out";let t=e.parentElement,n=t.getBoundingClientRect(),i=e.getBoundingClientRect(),a=0;for(let n=0;n<t.children.length&&t.children[n]!==e;n++){a+=t.children[n].getBoundingClientRect().height+2}e.style.position="absolute",e.style.top=a+"px",e.style.left=i.left-n.left+"px",e.style.width=i.width+"px",e.style.height=i.height+"px",e.style.zIndex="17000",yield R(200),e.remove()}))}}class te extends Y{constructor(e){super(e),this.level=0}addLevel(e){this.level+=e}setLevel(e){this.level=e,this.levelComp.textContent=e+""}getLevelComp(){return this.levelComp}getLevel(){return this.level}create(){let e=document.createElement("div");e.className="sta-construction-building-upgradeable",e.appendChild(this.createIcon(!0));let t=document.createElement("div");return t.className="sta-construction-building-level-upgradeable",t.textContent=this.getLevel()+"",this.levelComp=t,e.appendChild(t),e}}var ne=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class ie extends z{constructor(){var e;super("Konstruktion",[{short:"Aktiviert:",long:"Baut die ausgewählten Dörfer nach Bauplan aus, wenn der Bot läuft",setting:E.CONSTRUCTION_ENABLED,type:"checkbox"},{short:"Bauplan:",long:"Export-Code einer Konstruktions-Vorlage",setting:E.CONSTRUCTION_BUILD_CODE,type:"text"}]);try{this.decodeBuildplan(C(E.CONSTRUCTION_BUILD_CODE)),this.createBody();let t=B();+(null===(e=t.player)||void 0===e?void 0:e.villages)>1&&(t.features.Premium.active&&!t.features.AccountManager.possible?this.createPremium("Konstruktion für mehrere Dörfer mit Premium aktiv"):t.features.AccountManager.possible?this.createPremium("Account Manager kann aktiviert werden. Konstruktion kann nicht genutzt werden!"):this.createPremium("Konstruktion bei mehr als einem Dorf nur mit Premium möglich!")),this.runner=new ae(this)}catch(e){console.error(e)}}decodeBuildplan(e){let t;this.buildings=[],this.firstBuilding=void 0,this.lastBuilding=void 0,this.planName=void 0;try{t=atob(e)}catch(e){return void console.error("Ungültiger Code")}let n,i,a,r={number:te},s=B();for(let e in s.village.buildings){let t=new te(e);r[t.getId()]=t}for(let e=2;e<t.length;e+=2){if(244!=t.charCodeAt(e)&&244!=t.charCodeAt(e+1)||128!=t.charCodeAt(e+1)&&128!=t.charCodeAt(e+4)||128!=t.charCodeAt(e+2)||128!=t.charCodeAt(e+3)||(n?(i=e,244===t.charCodeAt(e+1)&&i++):(n=e+4,244===t.charCodeAt(e+1)&&n++)),n)continue;let s=t.charCodeAt(e),o=r[s],l=t.charCodeAt(e+1);o||(o=new te(s),r[s]=o),o.addLevel(l);let d=new ee(s,l,o,a);a&&a.setNext(d),a=d,this.firstBuilding||(this.firstBuilding=a)}if(this.lastBuilding=a,!this.firstBuilding&&!this.lastBuilding){let e=r[0];e.addLevel(1),this.firstBuilding=new ee(0,1,e,void 0),this.lastBuilding=this.firstBuilding}for(let e=0;e<20;e++)r[e]&&this.buildings.push(r[e]);this.planName=n&&i?t.substring(n,i).trim():"Default"}encodeBuildplan(e){let t="";t+="??";let n=e;for(;n;)t+=String.fromCharCode(n.getId()),t+=String.fromCharCode(n.getLevel()),n=n.getNext();t+=String.fromCharCode(244),t+=String.fromCharCode(128),t+=String.fromCharCode(128),t+=String.fromCharCode(128),t+=this.planName,t+=String.fromCharCode(244),t+=String.fromCharCode(128),t+=String.fromCharCode(128),t+=String.fromCharCode(128);let i=btoa(t.toString());y(E.CONSTRUCTION_BUILD_CODE,i);let a=this.component.getElementsByClassName("sta-setting-input-sta-construction-build-code")[0];a&&(a.value=i)}createBody(){let e=this.createHeader(this.planName);e.id="sta-buildplan-header",this.component.appendChild(e),this.component.appendChild(this.createBuildplan())}createBuildplan(){let e=document.createElement("div");return e.className="sta-construction-menu-buildplan",this.plan=this.createPlan(),e.appendChild(this.createBuildingSelector()),e.appendChild(this.plan),this.component.getElementsByClassName("sta-setting-input-sta-construction-build-code")[0].addEventListener("change",(t=>{t.preventDefault(),this.plan.remove(),this.decodeBuildplan(C(E.CONSTRUCTION_BUILD_CODE)),this.plan=this.createPlan(),e.insertBefore(this.plan,e.children[0]),document.getElementById("sta-buildplan-header").textContent=this.planName})),e}createPlan(){var e,t;let n=document.createElement("div");n.className="sta-construction-plan";let i,a=document.createElement("div");a.className="sta-construction-plan-inverter",a.textContent="Liste umdrehen",n.appendChild(a),n.appendChild(this.createPlanHeader());try{i=JSON.parse(C(E.VILLAGE_DATA))}catch(e){T("Could not load saved village data")}i||(i={});let r=document.createElement("div");r.className="sta-construction-entries","true"===C(E.CONSTRUCTION_PLAN_INVERTED)&&r.classList.add("sta-construction-plan-inverted"),n.appendChild(r);let s=this.firstBuilding;for(;s;)this.appendEntryToPlan(r,s,null===(t=null===(e=i[B().village.id])||void 0===e?void 0:e.buildings)||void 0===t?void 0:t[s.getName()]),s=s.getNext();return a.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),r.classList.contains("sta-construction-plan-inverted")?(y(E.CONSTRUCTION_PLAN_INVERTED,"false"),r.classList.remove("sta-construction-plan-inverted")):(y(E.CONSTRUCTION_PLAN_INVERTED,"true"),r.classList.add("sta-construction-plan-inverted"))})),n}appendEntryToPlan(e,t,n){e.appendChild(t.create()),t.paint(n),t.getComp().getElementsByClassName("sta-construction-entry-remove")[0].addEventListener("click",(e=>{e.preventDefault(),this.lastBuilding===t&&(this.lastBuilding=t.getPrevious()),this.firstBuilding===t&&(this.firstBuilding=t.getNext())}));let i=e=>{e.preventDefault(),e.stopPropagation(),this.encodeBuildplan(this.firstBuilding)};t.getComp().getElementsByClassName("sta-construction-entry-plus")[0].addEventListener("click",i),t.getComp().getElementsByClassName("sta-construction-entry-minus")[0].addEventListener("click",i),t.getComp().getElementsByClassName("sta-construction-entry-drag")[0].addEventListener("click",i),t.getComp().getElementsByClassName("sta-construction-entry-remove")[0].addEventListener("click",i)}createPlanHeader(){let e=document.createElement("div");e.className="sta-total-level";for(let t of this.buildings)e.appendChild(t.create()),t.getLevelComp().addEventListener("click",(e=>{var n,i,a,r;e.preventDefault(),e.stopPropagation();let s,o=new ee(t.getId(),1,t,this.lastBuilding);this.lastBuilding&&this.lastBuilding.setNext(o),this.lastBuilding=o,this.firstBuilding||(this.firstBuilding=o);try{s=JSON.parse(C(E.VILLAGE_DATA))}catch(e){T("Could not load saved village data")}s||(s={}),this.appendEntryToPlan(this.plan.getElementsByClassName("sta-construction-entries")[0],o,null===(i=null===(n=s[B().village.id])||void 0===n?void 0:n.buildings)||void 0===i?void 0:i[t.getName()]),o.addTotalLevel(o.getId()),o.paint(null===(r=null===(a=s[B().village.id])||void 0===a?void 0:a.buildings)||void 0===r?void 0:r[t.getName()]),this.encodeBuildplan(this.firstBuilding)}));return e}onLoad(e,t){return ne(this,void 0,void 0,(function*(){let n=this.runner.onLoad(e,t);if(n&&"true"===C(this.getEnabledSetting())&&this.isVillageEnabled(B().village.id)){let e=this.getNextBuilding(n),t=e=>{this.encodeBuildplan(this.firstBuilding)},i=document.getElementById("building_wrapper");for(let n=0;n<5;n++){let a=e.getPreviewComp(n);a.getElementsByClassName("sta-construction-entry-plus")[0].addEventListener("click",t),a.getElementsByClassName("sta-construction-entry-minus")[0].addEventListener("click",t),a.getElementsByClassName("sta-construction-entry-remove")[0].addEventListener("click",t),i.parentElement.insertBefore(a,i),e=e.getNext()}}}))}getNextBuilding(e){let t=this.firstBuilding;for(;t;){let n=e[t.getName()];if(n)if(n.nextLevel>t.getTotalLevel())t=t.getNext();else if(n.maxLevel<n.nextLevel)t=t.getNext();else{if(n.found)return t;t=t.getNext()}else T(t.getName()+" not found - Skip"),t=t.getNext()}}preRun(){return ne(this,void 0,void 0,(function*(){let e=B(),t=this.runner.preRun(this.firstBuilding);if(t)return e.features.AccountManager.possible?(L("Account Manager kann aktiviert werden. Konstruktion deaktiviert sich selbst!"),this.invertEnabled(this.getEnabledSetting()),!1):+e.player.villages>1&&!e.features.Premium.active?(L("Konstruktion bei mehr als einem Dorf nur mit Premium möglich! Konstruktion deaktiviert sich selbst!"),void this.invertEnabled(this.getEnabledSetting())):t}))}run(){return ne(this,void 0,void 0,(function*(){return this.runner.run(this.firstBuilding)}))}postRun(){this.runner.postRun()}}class ae extends K{constructor(e){super(),this.config=e}onLoad(e,t){let n=new URLSearchParams(t.search);if(n.has("screen")&&"overview_villages"===n.get("screen")&&n.has("mode")&&"buildings"===n.get("mode")){let t=this.getVillageDataFromMassUpgrade(e.getElementById("villages"));t&&y(E.VILLAGE_DATA,JSON.stringify(t))}if(n.has("screen")&&"main"===n.get("screen"))return this.readSingleVillageData(e,B().village.id)}getVillageDataFromMassUpgrade(e){let t;try{t=JSON.parse(C(E.VILLAGE_DATA))}catch(e){T("Exception reading village Data"),t={}}for(let n of e.children){let e=+n.id.substring(2);t[e]||(t[e]={coord:"",id:e,name:"",resources:{iron:0,stone:0,wood:0},buildings:{},queue:0}),t[e].buildings||(t[e].buildings={});for(let n of Object.keys(t[e].buildings))t[e].buildings[n].found=!1,t[e].buildings[n].canBuild=!1;let i=n.getElementsByClassName("queue_icon"),a={};for(let e of i){let t=e.children[0].src;t=t.substring(t.lastIndexOf("/")+1,t.lastIndexOf(".")),a[t]=a[t]?a[t]+1:1}t[e].queue=i.length;for(let i of n.getElementsByClassName("upgrade_building")){let n;for(let e of i.classList)if(e.startsWith("b_")){n=e.substring(2);break}let r=i.children.length>0?i.children[0]:void 0;r&&r.classList.contains("hidden")&&(r=void 0);let s=r?+r.textContent:+i.textContent;t[e].buildings[n]=Object.assign(Object.assign({},t[e].buildings[n]),{found:!0,error:void 0,forecast:void 0,level:s,canBuild:!!r,nextLevel:1+s+(a[n]?a[n]:0)})}}return t}readSingleVillageData(e,t){let n,i;try{n=JSON.parse(C(E.VILLAGE_DATA))}catch(e){T("Could not load saved village data"),n={}}n[t]||(n[t]={coord:"string",name:"string",id:t,resources:{wood:0,stone:0,iron:0},buildings:{},queue:0}),n[t].buildings||(n[t].buildings={});try{let t=$(e).find('script:contains("BuildingMain.buildings")'),n=t[t.length-1].innerHTML;i=JSON.parse(n.substring(30,n.length-2))}catch(e){T("Could not find BuildingMain.buildings")}if(!i)return n[t].buildings;for(let e in B().village.buildings)n[t].buildings[e]?n[t].buildings[e].found=!1:n[t].buildings[e]={canBuild:!1,error:"Doesn't exist",forecast:void 0,iron:0,level:0,maxLevel:0,nextLevel:0,population:0,require:void 0,stone:0,wood:0,found:!1};for(let e in B().village.buildings){let a=i[e];if(!a)continue;let r=n[t].buildings[e];r.found=!0,r.level=a.level_next-1,r.nextLevel=a.level_next,r.maxLevel=a.max_level,r.population=a.pop,r.wood=a.wood,r.stone=a.stone,r.iron=a.iron,r.require=a.require,r.forecast=a.forecast,r.error=a.error,r.canBuild=a.can_build,n[t]||(n[t]={coord:"string",name:"string",id:t,resources:{wood:0,stone:0,iron:0},buildings:{},queue:0}),n[t].buildings||(n[t].buildings={}),n[t].buildings[e]=r}return y(E.VILLAGE_DATA,JSON.stringify(n)),n[t].buildings}preRun(e){return ne(this,void 0,void 0,(function*(){let e=+C(E.CONSTRUCTION_NEXT_RUN);return!(Date.now()<e)}))}run(e){return ne(this,void 0,void 0,(function*(){let t=B();return t.features.Premium.active&&this.config.isPremium()?this.runPremium(e):this.runFree(e,t.village.id)}))}postRun(){y(E.REWARD_NEXT_RUN,"0")}runPremium(e){return ne(this,void 0,void 0,(function*(){let t=B();return O(`game.php?village=${t.village.id}&screen=overview_villages&mode=buildings`).then((n=>{let i=this.getVillageDataFromMassUpgrade($(n).find("#villages")[0]);return i&&y(E.VILLAGE_DATA,JSON.stringify(i)),O(`game.php?village=${t.village.id}&screen=main&ajax=get_all_possible_building_upgrades&destroy=0&page_start=0&page_size=${t.player.villages}&order=&dir=asc&group_id=0`).then((t=>{let n=this.getVillageDataWithUpdateLinks(t),i=!1;for(let t of Object.keys(n)){let a=n[+t];if(!this.config.isVillageEnabled(+t)){T(`${a.name} disabled for ${this.config.getName()}`);continue}if(a.queue>=5){T(`${a.name} queue full for ${this.config.getName()}`);continue}let r=this.findNextEntry(a.buildings,e);r?(i=!0,P("/game.php?village="+t+"&screen=main&ajaxaction=upgrade_building&type=main","id="+r.getName()+"&force=1&destroy=0&source="+t+"&h=+"+B().csrf).then((e=>{_(`${r.getUiName()} zur Bauschleife in ${a.name} hinzugefügt`),this.setNewRewardRun(e.date_complete)}))):T(`In ${a.name} nothing todo`)}i||y(E.CONSTRUCTION_NEXT_RUN,Date.now()+60*(45*Math.random()+15)*1e3+"")}))}))}))}getVillageDataWithUpdateLinks(e){let t;try{t=JSON.parse(C(E.VILLAGE_DATA))}catch(e){T("Exception reading village Data"),t={}}for(let n of Object.keys(e.villages)){let i=e.villages[n],a=+n;t[a]||(t[a]={coord:"",id:a,name:"",resources:{iron:0,stone:0,wood:0},buildings:{},queue:0}),t[a].buildings||(t[a].buildings={});for(let e of Object.keys(i.buildings))t[a].buildings[e]?(t[a].buildings[e].canBuild=!0,t[a].buildings[e].error=void 0,t[a].buildings[e].forecast=void 0):t[a].buildings[e]={error:void 0,forecast:void 0,found:!0,iron:0,level:0,maxLevel:0,nextLevel:0,population:0,require:{},stone:0,wood:0,canBuild:!0}}return t}canFinishEarly(e){try{let t=+$(e).find(".btn-instant-free")[0].getAttribute("data-available-from");if(Date.now()/1e3+180>t)return!0}catch(e){T("Could not find finish early button")}return!1}finishEarly(e){try{if(!this.canFinishEarly(e))return;let t=$(e).find(".btn-instant-free")[0].getAttribute("onclick"),n=t.indexOf("("),i=t.indexOf(")");t=t.substring(n+1,i);let a=t.split(","),r=a[1].split("'");BuildingMain.change_order(a[0],r[1],a[2])}catch(e){T("Could not finish early")}}runFree(e,t){return ne(this,void 0,void 0,(function*(){return O(`game.php?screen=main&village=${t}`).then((n=>{let i=new URLSearchParams(window.location.search);if(i.has("screen")&&"main"===i.get("screen")&&this.finishEarly(n),this.isQueueFull(n))return;let a=this.readSingleVillageData(n,t),r=this.findNextEntry(a,e);return r?(T("Upgrading "+r.getName()),r.getComp().style.backgroundColor="rgba(77,222,255,0.53)",P("/game.php?village="+t+"&screen=main&ajaxaction=upgrade_building&type=main","id="+r.getName()+"&force=1&destroy=0&source="+t+"&h=+"+B().csrf).then((e=>{_(`${r.getUiName()} zur Bauschleife hinzugefügt`),this.setNewRewardRun(e.date_complete)}))):(T("Nothing todo, sleep one hour for Construction"),_("Konstruktion beendet. Bitte das Feature ausschalten oder den Bauplan erweitern."),void y(E.CONSTRUCTION_NEXT_RUN,Date.now()+36e5+""))}))}))}setNewRewardRun(e){try{let t=Date.now()+e;+C(E.REWARD_NEXT_RUN)>t&&y(E.REWARD_NEXT_RUN,t+"")}catch(e){T("Could not update next reward run")}}isQueueFull(e){try{let t=$(e).find("#buildqueue")[0],n=function(e){try{let t=+JSON.parse($(e).find(".order-progress")[0].getAttribute("data-progress")).slot_end;return $(document).find(".btn-instant")[0]?t-180:t}catch(e){T("Could not find when next building finishes")}return 0}(e),i=t.children.length-2;if(t&&t.children&&i>=(B().features.Premium.active?5:2))return T("Queue full. Next building finishes in "+U(n)),y(E.CONSTRUCTION_NEXT_RUN,1e3*(n+5)+""),!0}catch(e){T("Could not read queue")}return!1}findNextEntry(e,t){let n=t;for(;n;){let t=e[n.getName()];if(t)if(t.nextLevel>n.getTotalLevel())n=n.getNext();else if(t.maxLevel<t.nextLevel)n=n.getNext();else{if(t.found)return t.forecast?(T("Upgrading "+n.getName()+" to "+t.nextLevel+" in "+U(t.forecast.when)),void y(E.CONSTRUCTION_NEXT_RUN,1e3*(+t.forecast.when+5)+"")):t.error?void T("Error: '"+t.error+"' for "+n.getName()):t.canBuild?n:void 0;n=n.getNext()}else T(n.getName()+" not found - Skip"),n=n.getNext()}}}var re=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class se extends z{constructor(){super("Belohnung",[{short:"Aktiviert:",long:"Löst Belohnungen für den Ausbau von Gebäuden ein",setting:E.REWARD_ENABLED,type:"checkbox"}]),this.runner=new oe}onLoad(e,t){return re(this,void 0,void 0,(function*(){}))}preRun(){return this.runner.preRun()}run(){return this.runner.run()}postRun(){return this.runner.postRun()}}class oe extends K{onLoad(e,t){}preRun(){return re(this,void 0,void 0,(function*(){var e,t;if((null!==(t=this.readRewardData(null===(e=$(document).find('script:contains("RewardSystem.setRewards(")')[0])||void 0===e?void 0:e.textContent))&&void 0!==t?t:[]).length>1)return!0;let n=+C(E.REWARD_NEXT_RUN);return!(Date.now()<n)}))}readRewardData(e){try{if(!e)return[];let t=e.indexOf("RewardSystem.setRewards("),n=(e=e.substring(t+24)).indexOf("]");e=e.substring(0,n+1);let i=JSON.parse(e);return i.length>0&&y(E.REWARD_NEXT_RUN,"0"),i}catch(e){return T("Error reading reward data"),[]}}run(){return re(this,void 0,void 0,(function*(){let e=B();return I(`game.php?village=${e.village.id}&screen=new_quests&ajax=quest_popup&tab=main-tab&quest=0`).then((t=>re(this,void 0,void 0,(function*(){let n=JSON.parse(t).response.dialog,i=this.readRewardData($(n)[2].textContent),a=[];for(let t of i)yield R(250),a.push(I(`game.php?village=${e.village.id}&screen=new_quests&ajax=claim_reward`,`reward_id=${t.id}&h=${e.csrf}`,"POST"));return 1===i.length?_(`${i.length} Belohnung abgeholt`):i.length>1&&_(`${i.length} Belohnungen abgeholt`),Promise.all(a)}))))}))}postRun(){y(E.REWARD_NEXT_RUN,Date.now()+36e5+""),y(E.CONSTRUCTION_NEXT_RUN,"0")}}var le=n(772),de={};de.styleTagTransform=p(),de.setAttributes=d(),de.insert=o().bind(null,"head"),de.domAPI=r(),de.insertStyleElement=u();t()(le.A,de);le.A&&le.A.locals&&le.A.locals;var ce=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class ue extends z{constructor(){super("Berichte",[{short:"Info:",long:"Fügt den Button 'Verarbeiten' oberhalb der Berichte hinzu, damit können alle Berichte anhang folgender Einstellungen verarbeitet werden",setting:E.REPORT_ENABLED,type:"checkbox"},{short:"Archivieren:",long:"Ordner in den die Berichte verschoben werden sollen",setting:E.REPORT_ARCHIVE,type:"text"},{short:"Datenbank Benutzer:",long:"Benutzer für www.diestaemmedb.de",setting:E.REPORT_DB_USER,type:"text"},{short:"Datenbank Passwort:",long:"Passwort für www.diestaemmedb.de",setting:E.REPORT_DB_PASSWORD,type:"password"}]);try{{let e=this.component.children[1].children[1].children[0];return e.disabled=!0,void S(e,"Noch nicht implementiert")}}catch(e){console.error(e)}}isReportPage(){let e=new URLSearchParams(window.location.search);return e.has("screen")&&"report"===e.get("screen")}createProcessButton(){let e=document.createElement("button");e.textContent="Verarbeiten",e.className="btn sta-report-process",e.addEventListener("click",(e=>ce(this,void 0,void 0,(function*(){e.stopPropagation(),e.preventDefault(),yield this.run(),this.postRun()}))));let t=document.getElementsByClassName("report-preview")[0].parentElement;t.insertBefore(e,t.children[0])}onLoad(e,t){return ce(this,void 0,void 0,(function*(){}))}preRun(){return ce(this,void 0,void 0,(function*(){return!1}))}run(){return ce(this,void 0,void 0,(function*(){let e=C(E.REPORT_DB_USER),t=C(E.REPORT_DB_USER);e&&t?this.selectAllAndPublish():L("Benutzer oder Passwort nicht gesetzt.")}))}postRun(){}selectAllAndPublish(){return ce(this,void 0,void 0,(function*(){yield R(100),document.getElementById("select_all").click(),yield R(100),document.getElementsByName("forward")[0].click();let e=new URLSearchParams(window.location.search);e.has("screen")&&"report"===e.get("screen")&&e.has("mode")&&"process_reports"===e.get("mode")&&e.has("refmode")&&"all"===e.get("refmode")&&document.getElementsByClassName("btn")[0].click()}))}}var he=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class pe{constructor(){this.features=[new ue,new ie,new se,new H],this.checkVillageCount().then((e=>he(this,void 0,void 0,(function*(){try{let e=this.createMenuButton();this.addMenuEntries(e),this.popup=new q(this.features);for(let e of this.features)yield e.onLoad(document,window.location);let t="true"===C(E.RUNNING);this.updateIcon(t),e.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();let t=!("true"===C(E.RUNNING));y(E.RUNNING,t+""),this.updateIcon(t)}))}catch(e){T("Exception during Menu.constructor"),T(e)}}))))}checkVillageCount(){return he(this,void 0,void 0,(function*(){let e;try{e=JSON.parse(C(E.VILLAGE_DATA))}catch(e){return void T("Error checking village count")}if(Object.keys(e).length!==+B().player.villages)return P(`/game.php?village=${B().village.id}&screen=groups&ajax=load_villages_from_group`,"group_id=0&h="+B().csrf).then((t=>{let n=[],i=$(t.html).find("#group_table")[0].children[0];for(let t of i.children){let i=t.children[0].children[0],a=+i.getAttribute("data-village-id"),r=i.textContent,s=t.children[1].textContent.trim();n.push(a),e[a]||(e[a]={coord:"string",name:"string",id:1,resources:{wood:0,stone:0,iron:0},buildings:{},queue:0}),e[a].name=r,e[a].id=a,e[a].coord=s}for(let t of Object.keys(e))n.includes(+t)||delete e[+t];y(E.VILLAGE_DATA,JSON.stringify(e)),T("Updated village list")}))}))}getFeatures(){return this.features}updateIcon(e){let t=document.getElementById("menuIcon");t.className=e?"icon header new_post":"icon header no_new_post"}createMenuButton(){let e=document.createElement("td");e.id="menuButton",e.className="menu-item";let t=document.getElementById("menu_row");t&&t.insertBefore(e,t.children[t.children.length-1]);let n=document.getElementById("mobileTouch");n&&n.insertBefore(e,n.children[n.children.length-1]);let i=document.createElement("span");i.id="menuIcon",i.className="icon header no_new_post";let a=document.createElement("a");return a.appendChild(i),a.id="iconContainer",a.innerHTML+=" Bot",e.appendChild(a),e}addMenuEntries(e){let t=document.createElement("table");e.appendChild(t),t.className="menu_column sta-menu-column";let n=document.createElement("tbody");t.appendChild(n);let i=!0;for(let e of this.features){let t,a;i?(i=!1,t="-first-child",a="sta-leftUiThingyFirstChild"):(t="",a="sta-leftUiThingy"),this.addItem(n,e,a,t)}this.addMenuBottom(n)}addItem(e,t,n,i){let a=document.createElement("tr");e.appendChild(a);let r=document.createElement("td");a.appendChild(r),r.className="menu-column-item sta-menu-column-item";let s=document.createElement("div");r.appendChild(s),s.className=n;let o=document.createElement("input");o.type="checkbox",o.className="sta-menu-item-checkbox"+i,o.checked="true"===C(t.getEnabledSetting()),o.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),t.invertEnabled(t.getEnabledSetting())})),t.subscribe((e=>{o.checked=e}),t.getEnabledSetting());let l=document.createElement("div");l.innerText=t.getName(),l.className="sta-menu-column-item-text"+i;let d=document.createElement("div");d.className="sta-menu-item-container",d.appendChild(o),d.appendChild(l),r.appendChild(d);let c=this;a.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),c.popup.show(t.getName())}))}addMenuBottom(e){let t=document.createElement("tr");e.appendChild(t);let n=document.createElement("td");t.appendChild(n),n.className="bottom";let i=document.createElement("div");i.className="corner sta-corner",n.appendChild(i);let a=document.createElement("div");a.className="decoration",n.appendChild(a)}}var ge=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};class me{constructor(e){setTimeout((()=>this.check(e)),5e3)}check(e){return ge(this,void 0,void 0,(function*(){for(;;){yield R(1e3*Math.floor(60*Math.random()));for(let t of e.getFeatures())if(yield R(5e3),t.isError())T("Skipping "+t.getName()+" because of previous error");else try{(yield this.run(t))&&T(t.getName()+" ran")}catch(e){T(e),L(`Fehler bei ${t.getName()}. Funktion wird deaktiviert bis die Seite neu geladen wird. Bei anhalten des Fehlers bitte Entwickler kontaktieren.`),t.setError(!0)}}}))}run(e){return ge(this,void 0,void 0,(function*(){if("true"!==C(E.RUNNING)||"true"!==C(e.getEnabledSetting()))return!1;try{if(!(yield e.preRun()))return!1}catch(t){throw T(e.getName()+" - Exception during preRun"),t}try{yield e.run()}catch(t){throw T(e.getName()+" - Exception during run"),t}try{e.postRun()}catch(t){T(e.getName()+" - Exception during postRun")}return!0}))}}var ve=n(595),fe={};fe.styleTagTransform=p(),fe.setAttributes=d(),fe.insert=o().bind(null,"head"),fe.domAPI=r(),fe.insertStyleElement=u();t()(ve.A,fe);ve.A&&ve.A.locals&&ve.A.locals;class Ee{constructor(){try{this.autoLogin(),this.createCheckboxes()}catch(e){T("Exception during Login.constructor"),T(e)}}createCheckboxes(){let e=document.getElementsByClassName("world-select"),t=!1;for(let n=0;n<e.length;n++){let i=e[n];if("Aktuelle Welten"!==i.parentElement.children[0].textContent)continue;i.classList.add("sta-login-item");let a=document.createElement("input");a.type="checkbox",i.href===C(E.AUTO_LOGIN_WORLD)&&(a.checked=!0,t=!0),a.addEventListener("change",(e=>{a.checked?(y(E.AUTO_LOGIN_WORLD,i.href),this.autoLogin()):N(E.AUTO_LOGIN_WORLD)})),i.insertBefore(a,i.children[0])}t||N(E.AUTO_LOGIN_WORLD);let n=e[0].parentElement;n.classList.add("sta-login-parent");let i=n.children[0];i.classList.add("sta-login-header"),i.textContent+=" (Checkbox für automatischen Login anwählen)"}login(){let e=C(E.AUTO_LOGIN_WORLD);e&&(window.location.href=e)}autoLogin(){setTimeout((()=>this.login()),1e3*(5*Math.random()+5))}}var be=function(e,t,n,i){return new(n||(n=Promise))((function(a,r){function s(e){try{l(i.next(e))}catch(e){r(e)}}function o(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))};function xe(){return be(this,void 0,void 0,(function*(){if(window.location.origin.includes("www.die-staemme.de"))return void new Ee;let e;if("0"!==B().player.sitter)return void console.log("Sitter mode detected - abort!");try{e=function(e){let t,n;try{let n=$(e).find('script:contains("TribalWars.updateGameData")')[0].innerHTML,i=n.indexOf("TribalWars.updateGameData(")+26,a=n.indexOf(");");t=JSON.parse(n.substring(i,a))}catch(e){T("Could not find TribalWars.updateGameData")}if(!t)throw"IDK anymore";try{n=JSON.parse(C(E.VILLAGE_DATA))}catch(e){T("Error during reading Village Data, create new"),n={}}let i=n[t.village.id];return i||(i={resources:{}}),i.resources||(i.resources={}),i.resources.wood=t.village.wood,i.resources.stone=t.village.stone,i.resources.iron=t.village.iron,i.name=t.village.name,i.id=t.village.id,i.storageMax=t.village.storage_max,n[i.id]=i,y(E.VILLAGE_DATA,JSON.stringify(n)),t}(document)}catch(e){T("Error reading game data")}let t=new pe;new me(t)}))}})(),staemme=i})();